#!/usr/bin/env bash
set -e

readonly STATE_FILE=".sisyphus/learning_state.json"
readonly DOCS_DIR="cline_docs"

# Create default state if not exists
if [ ! -f "$STATE_FILE" ]; then
    echo '{"status": "idle", "progress": {"currentStep": 1, "currentTask": "1.1"}}' > "$STATE_FILE"
fi

# [NEW] Initialize CRCT structure if missing
mkdir -p "$DOCS_DIR"
for doc in productContext.md systemPatterns.md techContext.md activeContext.md progress.md; do
    if [ ! -f "$DOCS_DIR/$doc" ]; then
        touch "$DOCS_DIR/$doc"
    fi
done

printf '{"cancel": false, "errorMessage":" "}'